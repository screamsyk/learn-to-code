# 哈希算法

在之前学习的 [散列表](11-散列表.md) 中，散列函数就是一种哈希算法。

> `hash` 翻译为 `散列`，音译为 `哈希`，所以无论叫 `散列`、`hash` 或 `哈希` 都是一个意思。

我们知道数据在计算机中，最终都是用二进制的方式表示的。

将任意长度的二进制值串映射为固定长度的二进制值串，即 `哈希值`，而这个映射规则就是 `哈希算法`。

`哈希值` 是二进制值串，通常用十六进制来表示，如 `b5dbd2c8c3e080e34db9053a36b2b2d3`。

## 一、哈希算法的要求

要设计出一个优秀的哈希算法，必须满足下列条件：

1. `无法逆运算`。即不能从哈希值推算出原始值。
2. `数据敏感`。即哪怕原始值只修改了一点点，计算出的哈希值也要大不相同。
3. `散列冲突概率小`。即哈希值重复的概率小，尽量保证唯一性。
4. `执行效率高`。即针对长文本，也能快速计算出哈希值

根据 [抽屉原理](https://baike.baidu.com/item/%E6%8A%BD%E5%B1%89%E5%8E%9F%E7%90%86/233776?fr=aladdin)，由于哈希值的长度固定且有限，能表示的数据也有限，所以对于无限的原始值，无法保证完全没有冲突，但可以尽量减少冲突。

## 二、哈希算法的应用

哈希算法除了在散列表中做 `散列函数` 外，还有很多其他的应用，如：

`安全加密`、`唯一标识`、`数据校验`、`负载均衡`、`数据分片`、`分布式存储` 等

这些应用都是依赖哈希算法的特性实现的。

### 2.1 安全加密

利用哈希算法无法逆运算，且哈希值冲突概率小的特性，可以用来对密码的明文进行单向加密。

常见的哈希算法进行安全加密的算法有：

* `MD5`（Message-Digest Algorithm，消息摘要算法）
* `SHA`（Secure Hash Algorithm，安全散列算法）

另外还有其他的安全加密算法，如：

* `DES`（Data Encryption Standard，数据加密标准），一种单钥加密算法
* `AES`（Advance Encryption Standard，高级加密标准），一种双钥加密算法

`MD5` 加密得到的哈希值，最长为 32 个十六进制位，即 32*4=128 个二进制位，可以表示 2^128 种哈希值。

由于哈希值的范围足够大，从而散列冲突的概率也小了很多，想要破解的难度也更大，但计算上也更耗时。

最常见的 `MD5` 破解是采用字典（用穷举类似），把常用的密码和对应的 `MD5` 加密后的哈希值存起来，再进行查找。

为了解决利用字典破解的问题，可以将明文先按一定规则转换下（即加盐 `salt`），再进行 `MD5` 加密。

### 2.2 唯一标识和数据校验

利用哈希算法可以将任意长度的输入映射为固定长度的输入，对数据文件内容计算哈希值，作为 `唯一标识`。

利用哈希算法对数据的敏感，只要数据变化，哈希值就会变，通过比较哈希值就可以进行 `数据校验`。

### 2.3 负载均衡、数据分片、分布式存储和一致性哈希算法

参考资料：[白话解析：一致性哈希算法 consistent hashing](http://www.zsythink.net/archives/1182)

`负载均衡`、`数据分片` 和 `分布式存储`，三者主要是将数据进行划分，存储在多个服务器中。

利用哈希算法，对数据计算哈希值，由于哈希值是二进制值串，所以可以作为数字进行 `取模运算` 或者 `取余运算`。

假设服务器个数为 `n`，通过对哈希值进行对 `n` 的取模运算，就可以知道数据该分到哪个服务器中。

为了避免服务器数量增加后，哈希值取模后，指向的服务器改变，需要大量移动数据。通常采用 `一致性哈希算法`：

```
1. 假设我们有 k 个机器，数据的哈希值的范围是 [0, MAX]。
2. 我们将整个范围划分成 m 个小区间（m 远大于 k）
3. 每个机器负责 m/k 个小区间
4. 这样当机器数量增加时，只需要移动小区间的数据
```

### 2.4 其他应用

哈希算法还有很多其他应用，比如我们使用 `Git` 提交代码后生成的 `commit id`，以及网络协议中的 `CRC` 校验。